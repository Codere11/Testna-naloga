<div class="container">
  <mat-form-field appearance="outline" class="search-field">
    <mat-label>Search products</mat-label>
<input matInput placeholder="Title or category" [ngModel]="query()" (ngModelChange)="query.set($event)" />
  </mat-form-field>

  <div class="table-wrapper" *ngIf="!store.loading(); else loadingTpl">
    <table mat-table [dataSource]="page()" class="mat-elevation-z1">
      <!-- Image -->
      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef> Image </th>
        <td mat-cell *matCellDef="let p">
          <img [src]="p.image" [alt]="p.title" width="40" height="40" />
        </td>
      </ng-container>

      <!-- Title -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef> Title </th>
        <td mat-cell *matCellDef="let p"> {{ p.title }} </td>
      </ng-container>

      <!-- Category -->
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef> Category </th>
        <td mat-cell *matCellDef="let p"> {{ p.category }} </td>
      </ng-container>

      <!-- Price -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef> Price </th>
        <td mat-cell *matCellDef="let p"> ${{ p.price | number: '1.2-2' }} </td>
      </ng-container>

      <!-- Rating -->
      <ng-container matColumnDef="rating">
        <th mat-header-cell *matHeaderCellDef> Rating </th>
        <td mat-cell *matCellDef="let p"> {{ p.rating?.rate ?? 'â€”' }} ({{ p.rating?.count ?? 0 }}) </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [length]="total()"
      [pageIndex]="pageIndex()"
      [pageSize]="pageSize()"
      [pageSizeOptions]="[5, 10, 20]"
      (page)="onPage($event)"
    />
  </div>

  <ng-template #loadingTpl>
    <div class="loading">
      <mat-progress-spinner mode="indeterminate" diameter="48" />
    </div>
  </ng-template>
</div>